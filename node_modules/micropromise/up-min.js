(function(root){"use strict";var task;if(typeof root!=="function"){try{root=global}catch(e){try{root=window}catch(e){}}task=root.setImmediate;if(typeof task!=="function"){if(root.process&&typeof root.process.nextTick==="function")task=root.process.nextTick;else if(root.vertx&&typeof root.vertx.runOnLoop==="function")task=root.vertx.RunOnLoop;else if(root.vertx&&typeof root.vertx.runOnContext==="function")task=root.vertx.runOnContext;else if(root.MessageChannel&&typeof root.MessageChannel==="function"){var fifo=[],channel=new root.MessageChannel;channel.port1.onmessage=function(){fifo.shift()()};task=function(f){fifo[fifo.length]=f;channel.port2.postMessage()}}else if(typeof root.setTimeout==="function")task=function(f){root.setTimeout(f,0)};else throw new Error("No candidate for setImmediate()")}}else task=root;function uP(proto){"use strict";proto=proto?proto:{};var promise,states=["pending","fulfilled","rejected"],state=0,value,timer,tuple=[];promise=Object.create(proto,{then:{value:then},defer:{value:defer},fulfill:{value:fulfill},reject:{value:reject},resolve:{value:resolve},status:{get:function(){return states[state]}},resolved:{get:function(){return value}},isPending:{get:function(){return state===0}}});if(typeof proto==="function")proto(promise);function then(f,r,n){var p=uP(proto);tuple[tuple.length]=[p,f,r,n];if(state)task(resolver);return p}function fulfill(x){if(!state){if(arguments.length>1)x=[].slice.call(arguments);state=1;value=x;task(resolver)}return this}function reject(x){if(!state){state=2;value=x;task(resolver)}return this}function defer(t){if(typeof t==="function")task(enclose(t));else if(Array.isArray(t))for(var i in t)defer(t[i]);else fulfill(t);return this}function enclose(func){try{func.call(promise)}catch(err){reject(err)}}function resolver(){var t,p,h,x=value;while(t=tuple.shift()){p=t[0];h=t[state];if(typeof h==="function"){try{x=h(value);p.resolve(x)}catch(e){p.reject(e)}}else{if(state==1)p.fulfill(x);else if(state==2)p.reject(x)}}}function resolve(x){var thenable,z=0,p=this;if(x===p)reject(new TypeError("x === p"));if(x&&(typeof x==="object"||typeof x==="function")){try{thenable=x.then}catch(e){reject(e)}}if(typeof thenable==="function"){try{thenable.apply(x,[function(y){if(!z++)p.resolve(y)},function(r){if(!z++)p.reject(r)}])}catch(e){if(!z++)reject(e)}}else{fulfill(x)}}return promise}if(module&&module.exports)module.exports=uP;else if(typeof define==="function"&&define.amd)define(uP);else root.uP=uP})(this);